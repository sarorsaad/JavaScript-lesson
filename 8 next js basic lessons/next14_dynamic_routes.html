<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next.js 14 Dynamic Routes and Static Generation</title>
    <style>
        body {
            margin-left: 20px;
            margin-right: 20px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        h1, h2 {
            color: #333;
        }
        .comparison {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison > div {
            flex: 1;
        }
        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffeeba;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Static Generation with Dynamic Routes in Next.js 14</h1>

    <div class="section">
        <h2>Introduction</h2>
        <p>Next.js 14 introduces a new way to generate static paths for dynamic routes at build time. This lesson covers:</p>
        <ul>
            <li>Understanding dynamic routes in Next.js</li>
            <li>Transitioning from getStaticPaths to generateStaticParams</li>
            <li>Configuring static exports</li>
            <li>Best practices and common pitfalls</li>
        </ul>
    </div>

    <div class="section">
        <h2>Previous Approach: getStaticPaths (Pre-Next.js 13)</h2>
        <p>In Next.js 12 and earlier, you would use getStaticPaths to generate static paths for dynamic routes:</p>
        <div class="code-block">
            // pages/posts/[postId].js
            export async function getStaticPaths() {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts');
                const posts = await response.json();

                const paths = posts.map((post) => ({
                    params: { postId: post.id.toString() },
                }));

                return { paths, fallback: false };
            }
        </div>
        <p>The getStaticPaths function was used in combination with getStaticProps to fetch and provide data for each path:</p>
        <div class="code-block">
            export async function getStaticProps({ params }) {
                const response = await fetch(`https://api.example.com/posts/${params.postId}`);
                const post = await response.json();
                return { props: { post } };
            }
        </div>
    </div>

    <div class="section">
        <h2>New Approach: generateStaticParams (Next.js 13+)</h2>
        <p>Next.js 14 introduces a simpler approach using generateStaticParams:</p>
        <div class="code-block">
            // app/posts/[postId]/page.js
            export async function generateStaticParams() {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts');
                const posts = await response.json();

                return posts.map((post) => ({
                    postId: post.id.toString(),
                }));
            }

            // Example of complete page implementation
            async function getPost(params) {
                const response = await fetch(
                    `https://jsonplaceholder.typicode.com/posts/${params.postId}`
                );
                if (!response.ok) {
                    throw new Error('Failed to fetch post');
                }
                return response.json();
            }

            export default async function Post({ params }) {
                const post = await getPost(params);
                
                return (
                    &lt;article&gt;
                        &lt;h1&gt;{post.title}&lt;/h1&gt;
                        &lt;div&gt;
                            &lt;p&gt;{post.body}&lt;/p&gt;
                        &lt;/div&gt;
                    &lt;/article&gt;
                );
            }
        </div>
        <p>Key differences from getStaticPaths:</p>
        <ul>
            <li>Simpler return format - just return the params object directly</li>
            <li>No need for separate getStaticProps function</li>
            <li>Works with the new App Router in Next.js 13+</li>
            <li>More intuitive API design</li>
        </ul>
        <div class="note">
            <p><strong>Important:</strong> With generateStaticParams:</p>
            <ul>
                <li>Data fetching is done directly in the page component</li>
                <li>Error handling should be implemented in the component</li>
                <li>The function runs at build time to generate static pages</li>
                <li>All specified routes will be pre-rendered as HTML</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>Visual Comparison</h2>
        <p>Here's a visual representation of how static route generation has evolved from Next.js 12 to Next.js 14:</p>
        <img src="../00xximg/next14_static_routes_comparison.svg" alt="Comparison between getStaticPaths and generateStaticParams approaches" style="max-width:100%; margin: 20px 0; display: block;" />
    </div>

    <div class="section">
        <h2>Configuring Static Exports</h2>
        <p>To generate static HTML files for your dynamic routes, you need to configure static exports in your Next.js project:</p>
        
        <div class="code-block">
            // next.config.js
            const nextConfig = {
                output: 'export',
            };

            module.exports = nextConfig;
        </div>

        <div class="note">
            <p><strong>Important Configuration Notes:</strong></p>
            <ul>
                <li>Setting output: 'export' tells Next.js to generate static HTML files during build</li>
                <li>The build process will create an 'out' directory containing all static assets</li>
                <li>All dynamic routes specified in generateStaticParams will be pre-rendered</li>
                <li>The static output can be deployed to any static hosting platform</li>
            </ul>
        </div>

        <p>After configuring, you can build your project with:</p>
        <div class="code-block">
            npm run build
        </div>
        <p>This will generate the static files in the 'out' directory, ready for deployment.</p>
    </div>

    <div class="section">
        <h2>Summary and Best Practices</h2>
        <div class="note">
            <p><strong>Key Points to Remember:</strong></p>
            <ul>
                <li>The generateStaticParams function pre-renders all dynamic routes at build time, improving performance and SEO</li>
                <li>If certain routes shouldn't be generated at build time, consider using fallback options or Server-Side Rendering (SSR)</li>
                <li>Always implement proper error handling in your page components</li>
                <li>Use TypeScript for better type safety in your dynamic parameters</li>
            </ul>
        </div>
        
        <p>Example of a complete implementation with fallback:</p>
        <div class="code-block">
            // app/posts/[postId]/page.js
            export async function generateStaticParams() {
                const posts = await fetch('https://api.example.com/posts').then(r => r.json());
                return posts.map((post) => ({
                    postId: post.id.toString(),
                }));
            }

            // Enable fallback for paths not generated at build time
            export const dynamicParams = true;

            export default async function Post({ params }) {
                const post = await getPost(params);
                if (!post) {
                    return &lt;div&gt;Loading...&lt;/div&gt;; // Shown during fallback generation
                }
                return &lt;article&gt;{/* Post content */}&lt;/article&gt;;
            }
        </div>
    </div>

</body>
</html>
